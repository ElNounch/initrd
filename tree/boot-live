# -*- shell-script -*-


mountroot() {
    attach_nbd_device 0

    live_mode=$(get_any live_mode "auto")
    rescue_image=$(get_any rescue_image)

    /bin/sh

    log_begin_msg "Formating nbd0"
    mkfs.ext4 /dev/nbd0
    log_end_msg

    mount_nbd 0 "${rootmnt}"

    log_begin_msg "Installing live image (${rescue_image})"
    curl -s -L "${rescue_image}" | tar -C "${rootmnt}" -x -f -
    sync
    log_end_msg

    attach_secondary_nbd_devices
}
